# =========================
# üöÄ BUILD PARA ASTRO
# =========================
[build]
command = "npm run build"
publish = "dist"

[build.environment]
# Node moderno y estable
NODE_VERSION = "20"
# (Opcional) Si alguna lib se pone quisquillosa con peer deps
NPM_FLAGS = "--legacy-peer-deps"

# =========================
# üåê REDIRECCIONES (OPCIONAL)
# =========================
# Act√≠valo S√ìLO si usas enrutamiento tipo SPA (una sola p√°gina con rutas del lado del cliente).
# Si tu sitio es multip√°gina est√°tica (lo t√≠pico en Astro), d√©jalo comentado.
# [[redirects]]
# from = "/*"
# to = "/index.html"
# status = 200

# =========================
# ‚öôÔ∏è CABECERAS: HTML (no cach√© fuerte)
# =========================
# Evita cachear agresivamente HTML para que los cambios se vean al publicar.
[[headers]]
for = "/*.html"
[headers.values]
  Cache-Control = "no-cache, no-store, must-revalidate"
  X-Frame-Options = "DENY"
  X-Content-Type-Options = "nosniff"
  Referrer-Policy = "strict-origin-when-cross-origin"
  # CSP b√°sica para sitios est√°ticos. Ajusta si agregas analytics/externos.
  Content-Security-Policy = """
    default-src 'self';
    img-src 'self' https: data:;
    font-src 'self' https: data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self';
    connect-src 'self';
    base-uri 'self';
    frame-ancestors 'none';
    upgrade-insecure-requests;
  """

# =========================
# ‚öôÔ∏è CABECERAS: ASSETS EMPAQUETADOS DE ASTRO
# =========================
# Astro publica assets fingerprinted (con hash) en /_astro/
# Podemos cachearlos MUY fuerte e inmutable.
[[headers]]
for = "/_astro/*"
[headers.values]
  Cache-Control = "public, max-age=31536000, immutable"

# =========================
# üñºÔ∏è IM√ÅGENES (si usas /images en public/)
# =========================
[[headers]]
for = "/images/*"
[headers.values]
  Cache-Control = "public, max-age=31536000, immutable"

# =========================
# üî§ FUENTES WEB (woff2/woff) CON CORS
# =========================
[[headers]]
for = "/fonts/*"
[headers.values]
  Cache-Control = "public, max-age=31536000, immutable"
  Access-Control-Allow-Origin = "*"

# =========================
# ü§ñ SEO B√ÅSICO: robots y sitemap
# =========================
[[headers]]
for = "/robots.txt"
[headers.values]
  Cache-Control = "public, max-age=86400"

[[headers]]
for = "/sitemap.xml"
[headers.values]
  Cache-Control = "public, max-age=86400"

# =========================
# üß© PLUGINS (OPCIONAL)
# =========================
# Ejemplo: minificar HTML al vuelo
# [[plugins]]
# package = "netlify-plugin-minify-html"
